# 정규화

- 데이터의 논리적 표현
    - 릴레이션 스키마의 설계
        - 논리적 데이터베이스 설계
        - 관계 모델을 이용하여 어떻게 실세계를 정확히 표현 할 것인가.
        1. 애트리뷰트, 엔티티, 관계성을 파악
        2. 관련된 애트리뷰트들을 릴레이션으로 묶는다
            - 애트리뷰트들간의 관계성, 데이터 종속성
            - 효율적인 데이터의 처리
            - 데이터의 일관성
        3. 변칙적 성질의 예방
            - 데이터 변경 시의 이상
    - 이상의 예
        
        ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled.png)
        
        - 삭제 이상(deletion anomaly)
            
            200번 학생이 'C123'과목을 등록 취소 시 200번이 3학년이라는 것도 손실
            
            → 연쇄 삭제에 의한 정보 손실
            
        - 삽입 이상(insertion anomaly)
            
            600번 학생이 2학년이라는 사실을 삽입 시 과목번호를 필수 삽입 해야된다 (과목번호가 기본키 인 경우)
            
            → 원하지 않는 정보의 강제 삽입
            
        - 갱신 이상(update anomaly)
            
            400번 학생의 학년을 4에서 3으로 변경시 학번 400에 대한 4개의 투플을 모두 변경해야된다
            
            → 중복 데이터의 일부 갱신으로 정보의 모순성이 발생한다
            
    - 이상의 원인과 해결책
        - 이상의 원인
            - 하나의 개체에 속한 애트리뷰트들 간에 존재하는 여러 개의 종속관계를 하나의 릴레이션으로 표현한다
        - 이상의 해결
            - 애트리뷰트들 간의 여러 종속관계를 분해하여 각각 하나의 릴레이션으로 표현한다
                
                → 정규화
                
    - 스키마 설계와 변환
        - 스키마의 설계 : 데이터베이스의 논리적 설계
            1. 애트리뷰트들과 이들의 제약조건들을 수집
            2. 수집된 결과를 명시된 제약조건에 따라 바람직한 여러개의 릴레이션으로 분할
                
                → 스키마 변환
                
        - 스키마 변환의 원리
            1. 정보 표현의 무손실 → 개선된 구조
            2. 최소의 데이터 중복
            3. 분리의 원칙 → 독립된 관계성은 별도의 릴레이션으로 분리시켜 표현
- 함수 종속(FD)
    - 함수 종속(functional dependency : FD) 이란
        - 어떤 릴레이션 R에서, R의 애트리뷰트의 부분집합 X,Y에 대하여 애트리뷰트 X의 값 각각에 대해 항상 애트리뷰트 Y의 값이 오직 하나만 연관
            
            → 애트리뷰트  Y는 애트리뷰트 X에 함수 종속 : X → Y
            
        - 애트리뷰트 X는 Y를 (함수적으로) 결정
            - X → 결정자
            - Y → 종속자
        - X나 Y는 각각 두개 이상의 애트리뷰트 집합이 될 수 있다
        - R에서 애트리뷰트 X가 키라면 → R의 모든 애트리뷰트 Y에 대해서 X → Y 이다.
        - 함수종속 X → Y 인 경우
            
            애트리뷰트 X가 반드시 '키'라는 것을 요건으로 하지 않는다.
            
            즉, X의 어느 한 값에 대응되는 Y 값을 갖는 투플이 둘 이상 존재 할 수 있다
            
            (같은 X값을 갖는 투플의 존재가 가능함)
            
    - 함수종속 다이어그램
        
        ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%201.png)
        
        수강 릴레이션 : 수강(학번, 과목번호, 학년, 성적)
        
        기본 키 : {학번, 과목번호}
        
        {학번, 과목번호} → 성적
        
        학번 → 학년
        
        1. '학년'은 '학번'에 완전 함수 종속
        2. '학년'은 {학번, 과목번호} 에 부분 함수 종속
        3. '성적'은 {학번, 과목번호}에 완전 함수 종속
    - 완전 함수 종속과 부분 함수 종속
        
        2개 이상으로 구성된 애트리뷰트 집합 X에 대하여 X → Y 가 성립 할 때
        
        - 완전 함수 종속
            
            X’⊂X이고 X’→Y가성립되는애트리뷰트X'이존재하지않는경우
            
            종속자가 기본키에만 종속되며, 기본키가 여러 속성으로 구성되어 있을경우 기본키를 구성하는 모든 속성이 포함된 기본키의 부분집합에 종속된 경우
            
        - 부분 함수 종속
            
            X’⊂X이고 X’→Y가성립되는 애트리뷰트X'이존재하는경우
            
            릴레이션에서 종속자가 기본키가 아닌 다른 속성에 종속되거나, 기본키가 여러 속성으로 구성되어 있을경우 기본키를 구성하는 속성 중 일부만 종속되는 경우
            
        - 함수 종속에 대한 추론 규칙
            - 암스트롱의 공리
                
                R1: (반사, reflexive) A ⊇ B이면 A → B이다. 또한 A → A이다 
                
                R2: (첨가, augmentation) A → B이면 AC → BC이고 AC → B이다. 
                
                R3: (이행, transitive) A → B이고 B → C이면 A → C이다.
                
                R4: (분해, decomposition) A → BC이면 A → B이다. 
                
                R5: (결합, union) A → B이고 A → C이면 A → BC이다.
                
            - 함수 종속은 데이터의 의미를 표현한다
                - '학번 → 학년'은 '학생은 한 학년에만 속한다' 라는 것을 의미
                - 의미적 제약 조건
            - DBMS는 함수 종속을 유지하기 위해 함수 종속을 스키마에 명세하는 방법과 함수 종속을 보장하는 방법을 제공해야 한다.
- 기본 정규형
    - 정규형이란 (Normal Form)
        - 어떤 일련의 제약조건 (constraints)를 만족하는 릴레이션
        - 정규화 즉 스키마 변환 (S → S')으로 정규형을 만든다
    - 정규화의 원칙
        1. 정보 표현의 무손실
            - 같은 의미의 정보 유지
            - 효율적인 구조
        2. 최소의 데이터 중복
        3. 분리의 원칙
            - 독립적인 관계는 별개의 릴레이션으로 표현
            - 릴레이션 각각에 대하여 독립적인 처리가 가능
- 제 1정규형 <1NF>
    - First Normal Form (1NF)의 정의
        - **모든 도메인이 원자값으로만 이루어진 릴레이션**
        
        <수강지도 릴레이션>
        
        - 수강지도 (학번, 지도교수, 학과, 과목번호, 성적)
        - 기본 키 : {학번, 과목번호}
        - 함수 종속 :
            - {학번, 과목번호} → 성적
            - 학번 → 지도교수
            - 학번 → 학과
            - 지도교수 → 학과
        
        ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%202.png)
        
        ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%203.png)
        
    - 1NF에서 이상
        1. 삽입이상
            
            → 500번 학생의 지도교수가 P4라고 삽입 하려 할 때 과목을 등록해야한다
            
        2. 삭제이상
            
            → 200번 학생이 'C123'를 취소하면, 200번의 지도교수가 P2라는 사실도 손실
            
        3. 갱신이상
            
            → 400번 학생이 P1 에서 P3으로 변경하는 경우, 학번이 400인 4개의 투플 모두 변경필요
            
    - 이상의 원인
        - 기본키에 부분 함수 종속된 애트리뷰트 존재
            
            → 기본키로 식별되는 개체와 무관한 애트리뷰트 존재
            
            → 두가지 독립적인 정보가 하나의 릴레이션으로 표현됨
            
    - 이상의 해결
        - 프로젝션으로 1NF 릴레이션을 분해한다 → 부분 함수 종속을 제거
- 제 2정규형 <2NF>
    - 2정규형의 정의
        
        **→ 1NF 에서 키에 속하지 않는 애트리뷰트들은 모두 기본 키에 완전 함수 종속**
        
    - 무손실 분해
        - 프로젝션으로 분해된 릴레이션들은 자연 조인을 통해 복귀가 가능
        - 원래의 릴레이션에서 얻을 수 있는 정보는 분해된 릴레이션에서도 얻을 수 있음 (역은 성립 x)
        - R(A,B,C)에서 함수 종속 A → B 라면 R1(A,B), R2(A,C)로 무손실 분해 가능
    
    수강지도 (학번, 지도교수, 학과, 과목번호, 성적)
    
    - 지도 (학번, 지도교수, 학과) :
        
        기본 키 → 학번
        
    - 수강 (학번, 과목번호, 성적) :
        
        기본 키 → {학번, 과목번호},
        
        외래 키 → {학번} 참조 : 지도
        
    
    ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%204.png)
    
    ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%205.png)
    
    - 2NF에서의 이상
        
        <이행적 함수 종속이 존재하여 이상이 발생함>
        
        릴레이션 R에 함수 종속 A → C 가 존재하고 함수 종속 A → B, B → C가 성립 할 때 C는 A에 이행적 함수 종속이다.
        
        1. 삽입 이상 → 어떤 지도교수가 특정 학과에 속하는지 삽입이 불가능
        2. 삭제 이상 → 300번 학생의 투플 삭제 시 지도교수가 컴퓨터 공학과라는 사실을 상실
        3. 갱신 이상 → 지도교수 P1이 소속을 컴퓨터 공학과에서 전자과로 변경시 학번이 100과 400인 투플을 모두 변경해야 한다.
        
        → 프로젝션으로 2NF 릴레이션을 분해 하여 이행적 함수 종속을 제거해야된다
        
- 제 3정규형 <3NF>
    
    **2NF이며 키가 아닌 모든 애트리뷰트들은 기본 키에 이행적 함수 종속이 되지 않는다.**
    
    - 무손실 분해
        
        원래의 릴레이션에서 얻을 수 있는 정보는 분해된 릴레이션들로부터 얻을 수 있으나 역은 성립하지 않는다
        
        ex → 학생지도와 지도교수학과로 분해한다.
        
        ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%206.png)
        
    - 3NF의 특징
        - 키가 아닌 애트리뷰트 값의 갱신 시 불필요한 부작용이 발생하지 않음
        - 모든 이원 릴레이션은 3NF에 속한다
    - 3NF의 약점
        
        <적용 할 수 없는 경우>
        
        1. 복수의 후보키를 가지고 있음
        2. 후보키들이 두개 이상의 애트리뷰트들로 구성됨
        3. 후보키들의 애트리뷰트가 중첩됨
    - 예시 (수강과목 릴레이션)
        - 제약조건
            - 한 학생은 한 교수의 강의만 수강
            - 각 교수는 한 과목만 담당
            - 같은 과목을 여러 교수가 담당 할 수 있음
        - 수강과목 (학번, 과목, 교수)
        - 후보 키 : {학번, 과목}, {학번, 교수}
        - 기본 키 : {학번, 과목}
        - 함수 종속 : {학번, 과목} → 교수, 교수 → 과목
    
    ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%207.png)
    
    - 3NF에서의 이상
        - 삽입 이상 → 교수 P5가 자료 구조를 담당한다는 사실의 삽입은 학번이 있어야 된다
        - 삭제 이상 → 100번 학생이 자료구조를 취소한다면 P2가 담당 교수라는 정보도 삭제
        - 갱신 이상 → P1이 프로그램이 과목 대신 자료구조를 담당한다면, P1의 모둔 투플을 변경
    
    → 교수가 결정자이지만 후보 키가 아니라서 발생하는 문제
    
- 보이스/코드 정규형
    - Boyce / Codd Normal Form (BCNF)란
        - 릴레이션 R의 결정자가 모두 후보키 라면 릴레이션 R 은 BCNF이다
        - 강한 제 3 정규형이다
        - R이 BCNF라면 R은 1,2,3 정규형에 속한다
- 고급 정규형
    
    ![Untitled](%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20ea76d9b75e3b4667abfc4a83b52eaae2/Untitled%208.png)
    
    **BCNF인 CPT 릴레이션의 제약조건**
    
    - 만일 CPT에 투플 <c1, p1, t1>과 <c1, p2, t2>가 포함되어 있다면 두개의 투플 <c1, p1, t2>와 <c1, p2, t1>도 포함되어 있어야 된다.
    
    **CPT 릴레이션에서의 변경 이상**
    
    - P4가 데이터베이스를 담당한다는 정보를 삽입하려면, 3개의 데이터베이스 교재 (T3, T4, T5) 에 대한 투플을 삽입해야 된다.
    
    **BCNF 이상의 원인**
    
    → 과목은 교수나 교재의 값 하나를 결정하는 거싱 아닌 값의 집합을 결정
    
    **다치 종속**
    
    - A, B, C가 릴레이션 R의 애트리뷰트의 부분 집합이라 할 때 애트리뷰트 쌍 (A, C)값에 대응되는 B 값의 집합이 A 값에만 종속되고, C 값에는 독립적이면 B 는 A 에 **다치종속**이며 A↠B 로 표기된다.
    - A ↠ B 이면 A ↠ C 도 성립되면 A ↠ B | C이다.
        - CPT 릴레이션에서 과목 ↠ 교재 이기에, 과목 ↠ 교수도 성립된다.
    - 모든 FD 는 MVD이다.
        - A → B 라면 A ↠ B 이다.
    - MVD를 가진 릴레이션의 분해
        - R(A,B,C)에서 MVD A ↠ B | C를 만족하면, 두 프로젝션 R1(A,B)와 R2(A,C)는 무손실 분해이다.
- 제 4정규형 <4NF>
    
    
- 제 5정규형 <5NF>